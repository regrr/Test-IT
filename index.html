<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<title>NEBULA IT — AI-решения, веб и интеграции</title>
<meta name="description" content="Светлый корпоративный лук: AI-боты, мини-приложения, веб-сервисы и интеграции. Крупная типографика, «пилюли», кейсы, форма, графики."/>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#f7f9fe; --paper:#ffffff; --ink:#0e1320; --mut:#616b7c; --line:#e6eaf2;
  --acc:#243cff; --acc2:#7aa2ff; --pill:#eef2ff; --ok:#16a34a; --warn:#d97706; --err:#dc2626;
  --r:16px; --shadow:0 18px 48px rgba(16,24,40,.08); --container:1240px;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;scroll-behavior:smooth}
main{scroll-snap-type:y mandatory}
section{min-height:100svh;scroll-snap-align:start;display:flex;align-items:center;padding:84px 0}
.container{max-width:var(--container);margin:0 auto;padding:0 20px}

/* Light ref-геро фон + сетка */
.hero-bg{position:fixed;inset:0;z-index:-2;background:
 radial-gradient(1200px 600px at 50% -10%, rgba(36,60,255,.18), transparent 55%),
 linear-gradient(180deg,#eef3ff 0%,rgba(238,243,255,0) 35%);}
.grid-overlay{position:fixed;inset:0;z-index:-1;opacity:.35;mask-image:linear-gradient(#000,transparent 70%)}
.grid-overlay canvas{width:100%;height:100%}

/* Header pills */
header{position:sticky;top:0;z-index:1000;background:rgba(255,255,255,.9);backdrop-filter:saturate(130%) blur(10px);border-bottom:1px solid var(--line)}
.nav{display:flex;align-items:center;justify-content:space-between;padding:12px 0}
.brand{display:flex;align-items:center;gap:10px;font-weight:700}
.brand svg{flex:0 0 32px}
.menu{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.menu a,.menu button.pill{padding:10px 14px;border-radius:999px;background:var(--pill);color:#0e1320cc;border:1px solid var(--line);font-weight:600}
.menu a.active{background:linear-gradient(90deg,#eaf0ff,#f7f9ff);border-color:#d7def0;color:var(--ink)}
.menu a:hover,.menu button.pill:hover{box-shadow:0 8px 24px rgba(36,60,255,.12)}
.btn{display:inline-flex;align-items:center;gap:10px;padding:12px 18px;border-radius:999px;font-weight:700;border:0;background:linear-gradient(135deg,var(--acc),var(--acc2));color:#fff;box-shadow:0 14px 40px rgba(36,60,255,.28)}
.btn.light{background:#fff;color:var(--ink);border:1px solid var(--line);box-shadow:0 8px 24px rgba(15,23,42,.06)}

/* Dropdown */
.dropdown{position:relative}
.drop{position:absolute;top:110%;left:0;background:#fff;border:1px solid var(--line);border-radius:14px;box-shadow:var(--shadow);padding:10px;display:none;min-width:300px}
.drop a{display:flex;gap:8px;align-items:center;padding:10px;border-radius:10px;color:var(--ink)}
.drop a:hover{background:#f6f8ff}
.dropdown.open .drop{display:block}

/* Blocks */
.paper{background:var(--paper);border:1px solid var(--line);border-radius:var(--r);padding:22px}
.kicker{display:inline-flex;gap:8px;align-items:center;padding:8px 12px;border:1px solid var(--line);border-radius:999px;background:#fff;color:var(--mut)}
h1{font-size:clamp(34px,6vw,72px);font-weight:700;letter-spacing:-.02em;line-height:1.06;margin:12px 0}
h2{font-size:clamp(26px,3.6vw,40px);margin-bottom:8px}
h3{font-size:clamp(18px,2.4vw,22px);margin:6px 0}
p{line-height:1.6}
.mut{color:var(--mut)}
.grid-hero{display:grid;grid-template-columns:1.05fr .95fr;gap:26px;align-items:center}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
.grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
.card{background:#fff;border:1px solid var(--line);border-radius:14px;padding:16px;transition:transform .22s, box-shadow .22s}
.card:hover{transform:translateY(-3px);box-shadow:var(--shadow)}
.tag{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid var(--line);background:#fff;color:var(--mut);font-size:12px}
.code{font-family:"JetBrains Mono",ui-monospace,Menlo,monospace;font-size:13.5px;background:linear-gradient(#fff,#f7f9ff);border:1px solid var(--line);border-radius:14px;padding:16px}
.cursor{display:inline-block;width:10px;background:var(--acc);animation:blink 1.1s infinite}
@keyframes blink{0%,49%{opacity:1}50%,100%{opacity:0}}

/* Shots */
.shots{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
.shot{position:relative;border:1px solid var(--line);border-radius:16px;overflow:hidden;background:#fff}
.shot img{width:100%;height:260px;object-fit:cover;display:block}
.shot .lbl{position:absolute;left:10px;top:10px}

/* Stats */
.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
.stat{background:#fff;border:1px solid var(--line);border-radius:14px;padding:18px;text-align:center}
.stat strong{display:block;font-size:clamp(24px,3.4vw,32px)}

/* Charts */
.charts{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.chart{background:#fff;border:1px solid var(--line);border-radius:14px;padding:12px}

/* FAQ */
.faq{display:grid;gap:10px}
.faq details{background:#fff;border:1px solid var(--line);border-radius:14px;padding:12px}
.faq summary{font-weight:700;cursor:pointer;list-style:none}
.faq summary::-webkit-details-marker{display:none}
.faq summary:after{content:"▾";float:right;transition:.2s}
.faq details[open] summary:after{transform:rotate(180deg)}

/* Arrow + progress */
.scrollHint{position:fixed;left:50%;bottom:16px;transform:translateX(-50%);z-index:900;display:flex;flex-direction:column;align-items:center;gap:6px}
.scrollHint button{width:46px;height:46px;border-radius:999px;border:1px solid var(--line);background:#fff;box-shadow:0 10px 28px rgba(0,0,0,.08);cursor:pointer;font-size:18px;color:var(--acc);animation:bob 1.6s ease-in-out infinite}
.scrollHint .txt{font-size:12px;color:var(--mut)}
@keyframes bob{0%,100%{transform:translateX(-50%) translateY(0)}50%{transform:translateX(-50%) translateY(8px)}}
.progress{position:fixed;inset:0 0 auto 0;height:3px;background:linear-gradient(90deg,var(--acc),var(--acc2));transform-origin:left;transform:scaleX(0);z-index:1200}

/* Footer */
footer{padding:28px 0;border-top:1px solid var(--line);background:#fff;color:var(--mut)}

/* Responsive */
@media (max-width:1100px){.grid-hero{grid-template-columns:1fr}.shots{grid-template-columns:1fr 1fr}.stats{grid-template-columns:1fr 1fr}.charts{grid-template-columns:1fr}}
@media (max-width:720px){
  .menu{gap:8px}
  .menu a,.menu button.pill{padding:8px 12px}
  .grid-2,.grid-3,.grid-4,.shots,.stats{grid-template-columns:1fr}
  .btn{width:100%}
  section{padding:68px 0}
}
</style>
</head>
<body>
<div class="hero-bg"></div>
<div class="grid-overlay"><canvas id="grid"></canvas></div>
<div class="progress" id="progress"></div>

<header>
  <div class="container nav">
    <a href="#hero" class="brand" aria-label="NEBULA IT">
      <svg viewBox="0 0 36 36" width="36" height="36" aria-hidden="true">
        <defs><linearGradient id="g" x1="0" y1="1" x2="1" y2="0"><stop offset="0" stop-color="#243cff"/><stop offset="1" stop-color="#7aa2ff"/></linearGradient></defs>
        <rect width="36" height="36" rx="10" fill="url(#g)"/>
        <path d="M18 9 19.8 15.2 26 17 19.8 18.8 18 25 16.2 18.8 10 17 16.2 15.2Z" fill="#0e1320"/>
        <path d="M28 22a10 10 0 1 1-6-12" fill="none" stroke="#0e1320" stroke-width="2" opacity=".35"/>
      </svg>
      NEBULA IT
    </a>
    <nav class="menu" aria-label="Главное меню">
      <a href="#hero">Главная</a>
      <span class="dropdown" id="dd">
        <button class="pill" type="button" aria-expanded="false">Услуги ▾</button>
        <div class="drop" role="menu" aria-label="Список услуг">
          <a href="#services">Компьютерное зрение (CV)</a>
          <a href="#services">NLP и ассистенты</a>
          <a href="#services">AI-автоматизация</a>
          <a href="#services">Веб-разработка</a>
          <a href="#solutions">Чат-боты</a>
          <a href="#solutions">TG/VK Mini-Apps</a>
        </div>
      </span>
      <a href="#about">О нас</a>
      <a href="#cases">Проекты</a>
      <a href="#partners">Партнёрам</a>
      <a href="#contact" class="btn light">Обсудить проект</a>
    </nav>
  </div>
</header>

<main>
  <!-- HERO -->
  <section id="hero">
    <div class="container">
      <div class="paper">
        <div class="grid-hero">
          <div>
            <span class="kicker">Эффективные решения</span>
            <h1>AI-решения для вашего бизнеса</h1>
            <p class="mut">Автоматизируем лидогенерацию, поддержку и продажи. Интеграции с CRM, платёжными шлюзами и аналитикой. Сроки и KPI — в договоре.</p>
            <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
              <a class="btn" href="#contact">Заказать решение</a>
              <a class="btn light" href="#cases">Портфолио</a>
            </div>
          </div>
          <div class="code"><pre><code># nebula.pipeline
stages: [audit, prototype, sprints, launch]
targets: { web: nextjs@vercel, api: fastapi@cloud }
integrations: [crm, payments, webhooks, analytics]
slo: { uptime: '≥99.5%', p95: '&lt;300ms' }
<span class="cursor"> </span></code></pre></div>
        </div>
      </div>
      <div class="stats" style="margin-top:16px">
        <div class="stat"><strong>90%</strong><span class="mut">клиентов остаются</span></div>
        <div class="stat"><strong>White-Label</strong><span class="mut">работаем под ваш бренд</span></div>
        <div class="stat"><strong>20+</strong><span class="mut">реализованных решений</span></div>
        <div class="stat"><strong>2 мес</strong><span class="mut">средний срок MVP</span></div>
      </div>
    </div>
  </section>

  <!-- ABOUT -->
  <section id="about">
    <div class="container">
      <div class="paper">
        <h2>О компании</h2>
        <div class="grid-3" style="margin-top:10px">
          <div class="card"><h3>Миссия</h3><p class="mut">Скорость, измеримость, безопасность. Каждый релиз приносит экономический эффект.</p></div>
          <div class="card"><h3>Форматы</h3><p class="mut">Fixed Price · Time&Material · Dedicated Team. Подбираем под цель и риск.</p></div>
          <div class="card"><h3>Соответствие</h3><p class="mut">Политика ПДн, RBAC, журналы аудита, постмортемы, SLA/OLA.</p></div>
        </div>
      </div>
    </div>
  </section>

  <!-- SERVICES -->
  <section id="services">
    <div class="container">
      <div class="paper">
        <h2>Услуги</h2>
        <div class="grid-3" style="margin-top:10px">
          <div class="card"><span class="tag">CV</span><h3>Компьютерное зрение</h3><p class="mut">Поиск объектов, OCR, контроль качества, трекинг.</p></div>
          <div class="card"><span class="tag">NLP</span><h3>Обработка текста</h3><p class="mut">RAG, ассистенты, классификация, тональность.</p></div>
          <div class="card"><span class="tag">BPM</span><h3>AI-автоматизация</h3><p class="mut">Сценарии, очереди, вебхуки, оркестрация.</p></div>
          <div class="card"><span class="tag">WEB</span><h3>Веб-разработка</h3><p class="mut">ЛК, дашборды, порталы, лендинги.</p></div>
          <div class="card"><span class="tag">BOT</span><h3>Чат-боты</h3><p class="mut">Telegram/VK/WA, оплаты, CRM, mini-apps.</p></div>
          <div class="card"><span class="tag">SLA</span><h3>Поддержка</h3><p class="mut">8×5/24×7, мониторинг, DR-планы.</p></div>
        </div>
      </div>
    </div>
  </section>

  <!-- SOLUTIONS (mini-apps/боты как в старой версии) -->
  <section id="solutions">
    <div class="container">
      <div class="paper">
        <h2>Готовые решения</h2>
        <div class="grid-4" style="margin-top:10px">
          <div class="card"><span class="tag">Лид-бот</span><h3>Квиз + оплата</h3><p class="mut">Собирает заявку, принимает оплату, пишет в CRM.</p></div>
          <div class="card"><span class="tag">Саппорт-бот</span><h3>FAQ + оператор</h3><p class="mut">Отвечает на типовые вопросы, эскалирует диалоги.</p></div>
          <div class="card"><span class="tag">HR-бот</span><h3>Онбординг</h3><p class="mut">Шаги, статусы, напоминания и отчёты.</p></div>
          <div class="card"><span class="tag">Mini-App</span><h3>Каталог</h3><p class="mut">Витрина, корзина, чек-аут, чеки.</p></div>
        </div>
      </div>
    </div>
  </section>

  <!-- CASES -->
  <section id="cases">
    <div class="container">
      <div class="paper">
        <h2>Реализовали для клиентов</h2>
        <div class="shots" style="margin-top:10px">
          <figure class="shot"><span class="lbl tag">FinTech</span><img src="https://images.unsplash.com/photo-1556157382-97eda2d62296?q=80&w=1600&auto=format&fit=crop" alt="Панель аналитики"></figure>
          <figure class="shot"><span class="lbl tag">E-commerce</span><img src="https://images.unsplash.com/photo-1460925895917-afdab827c52f?q=80&w=1600&auto=format&fit=crop" alt="Онлайн-торговля"></figure>
          <figure class="shot"><span class="lbl tag">AI Ops</span><img src="https://images.unsplash.com/photo-1518770660439-4636190af475?q=80&w=1600&auto=format&fit=crop" alt="AI-операции"></figure>
        </div>
        <div class="grid-4" style="margin-top:14px">
          <div class="card"><h3>−38%</h3><p class="mut">ручных операций</p></div>
          <div class="card"><h3>+12%</h3><p class="mut">конверсия</p></div>
          <div class="card"><h3>240 мс</h3><p class="mut">p95 API</p></div>
          <div class="card"><h3>99.5%</h3><p class="mut">аптайм SLA</p></div>
        </div>
      </div>
    </div>
  </section>

  <!-- STACK + интеграции (партнёры) -->
  <section id="partners">
    <div class="container">
      <div class="paper">
        <h2>Технологии и интеграции</h2>
        <p class="mut">Готовы к облаку и on-prem. Подключаем популярные CRM и платёжные шлюзы.</p>
        <div class="grid-3" style="margin-top:10px">
          <div class="card"><h3>Стек</h3><p class="mut">Next.js · FastAPI · Postgres · Redis · ClickHouse.</p></div>
          <div class="card"><h3>Интеграции</h3><p class="mut">amoCRM · Bitrix24 · 1С · Webhooks · SSO.</p></div>
          <div class="card"><h3>Платежи</h3><p class="mut">ЮKassa · Stripe · CloudPayments.</p></div>
        </div>
      </div>
    </div>
  </section>

  <!-- PROCESS + ANALYTICS (с графиками из твоей версии) -->
  <section id="process">
    <div class="container">
      <div class="paper">
        <h2>Процесс и аналитика</h2>
        <div class="grid-2" style="margin-top:10px">
          <div>
            <div class="card"><strong>01 · Диагностика</strong><p class="mut">Цели, риски, KPI, прототип-скетчи.</p></div>
            <div class="card"><strong>02 · Спринты</strong><p class="mut">Итерации 1–2 недели. Демо каждую неделю.</p></div>
            <div class="card"><strong>03 · Запуск</strong><p class="mut">Пилот, метрики эффекта, план развития.</p></div>
          </div>
          <div>
            <div class="charts">
              <div class="chart">
                <svg id="lineChart" viewBox="0 0 600 260" width="100%" height="260" aria-label="График роста">
                  <rect x="0" y="0" width="600" height="260" fill="#fff" rx="14" ry="14" stroke="var(--line)"/>
                  <g stroke="#eef2f7"><line x1="40" x2="560" y1="50" y2="50"/><line x1="40" x2="560" y1="100" y2="100"/><line x1="40" x2="560" y1="150" y2="150"/><line x1="40" x2="560" y1="200" y2="200"/></g>
                  <polyline id="poly" fill="none" stroke="url(#grad)" stroke-width="3" points=""/>
                  <defs><linearGradient id="grad" x1="0" y1="0" x2="1" y2="0"><stop offset="0%" stop-color="#243cff"/><stop offset="100%" stop-color="#7aa2ff"/></linearGradient></defs>
                </svg>
                <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:8px">
                  <label>A <input id="a" type="range" min="0" max="100" value="30"></label>
                  <label>B <input id="b" type="range" min="0" max="100" value="60"></label>
                  <label>C <input id="c" type="range" min="0" max="100" value="80"></label>
                  <button class="btn light" id="btnResetCharts">Сброс</button>
                </div>
              </div>
              <div class="chart">
                <svg id="donut" viewBox="0 0 220 220" width="100%" height="220" aria-label="Каналы">
                  <circle cx="110" cy="110" r="80" fill="#fff" stroke="#eef2f7" stroke-width="18"/>
                  <circle id="d1" cx="110" cy="110" r="80" fill="none" stroke="#243cff" stroke-width="18" stroke-dasharray="0 502" transform="rotate(-90 110 110)"/>
                  <circle id="d2" cx="110" cy="110" r="80" fill="none" stroke="#7aa2ff" stroke-width="18" stroke-dasharray="0 502" transform="rotate(-90 110 110)"/>
                  <circle id="d3" cx="110" cy="110" r="80" fill="none" stroke="#c7d2fe" stroke-width="18" stroke-dasharray="0 502" transform="rotate(-90 110 110)"/>
                  <text id="donutLabel" x="110" y="118" text-anchor="middle" font-size="16">Каналы</text>
                </svg>
                <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px">
                  <label>Organic <input id="dn1" type="range" min="0" max="100" value="40"></label>
                  <label>Paid <input id="dn2" type="range" min="0" max="100" value="35"></label>
                  <label>Referrals <input id="dn3" type="range" min="0" max="100" value="25"></label>
                </div>
              </div>
            </div>
            <p class="mut" style="margin-top:10px">Смещение в Organic снижает CAC, Paid ускоряет тесты, Referrals стабилизирует качество лидов.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- FAQ + CONTACT -->
  <section id="contact">
    <div class="container">
      <div class="paper">
        <div class="grid-2">
          <div>
            <h2>Остались вопросы?</h2>
            <div class="faq" style="margin-top:10px">
              <details><summary>Сроки MVP?</summary><p class="mut">4–8 недель при готовом контенте и быстрых согласованиях.</p></details>
              <details><summary>Безопасность ПДн?</summary><p class="mut">RBAC, минимизация данных, шифрование, журналы аудита.</p></details>
              <details><summary>SLA после запуска?</summary><p class="mut">Да. 8×5/24×7, TTR от 30 мин, DR-план.</p></details>
            </div>
            <p class="mut" style="margin-top:10px">Москва · hello@example.com · t.me/nebula_it</p>
            <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
              <a class="btn light" href="#">Telegram</a>
              <a class="btn light" href="#">GitHub</a>
              <a class="btn light" href="#">LinkedIn</a>
              <button class="btn light" id="btnReq">Реквизиты</button>
            </div>
          </div>
          <form id="briefForm" class="card" style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
            <input name="name" placeholder="Имя*" required aria-label="Имя"/>
            <input name="email" type="email" placeholder="Email*" required aria-label="Email"/>
            <input name="company" placeholder="Компания" aria-label="Компания"/>
            <input name="phone" placeholder="Телефон" aria-label="Телефон"/>
            <textarea name="goal" placeholder="Опишите задачу" style="grid-column:1/-1;min-height:100px;border:1px solid var(--line);border-radius:12px;padding:10px"></textarea>
            <div style="display:flex;gap:10px;grid-column:1/-1;align-items:center">
              <button class="btn" type="submit">Получить консультацию</button>
              <span id="formMsg" class="mut"></span>
            </div>
          </form>
        </div>
      </div>
    </div>
  </section>
</main>

<footer>
  <div class="container" style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
    <div>© <span id="year"></span> NEBULA IT</div>
    <div class="mut">Политика · Публичная оферта</div>
  </div>
</footer>

<div class="scrollHint" id="hint"><button aria-label="Листать вниз">↓</button><div class="txt">Листать</div></div>

<!-- Modal requisites -->
<div id="modalReq" hidden style="position:fixed;inset:0;display:grid;place-items:center;background:rgba(15,23,42,.35);z-index:1200">
  <div class="paper" style="width:min(640px,92vw)">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
      <h3 style="margin:0">Реквизиты (пример)</h3>
      <button class="btn light" id="btnReqClose">Закрыть</button>
    </div>
    <div style="display:grid;gap:6px;margin-top:8px">
      <div><strong>ООО «Небула Тех»</strong></div>
      <div class="mut">ИНН 7723456789 · КПП 770301001 · ОГРН 1234567890123</div>
      <div class="mut">Банк: ПАО «ТехБанк» · БИК 044525225</div>
      <div class="mut">р/с 40702810900000123456 · к/с 30101810400000000225</div>
      <div class="mut">Юр. адрес: 125000, г. Москва, ул. Пример, д. 1</div>
    </div>
  </div>
</div>

<script>
// grid overlay
(function(){
  const c=document.getElementById('grid');
  function draw(){const ctx=c.getContext('2d');const w=c.width=innerWidth,h=c.height=innerHeight;ctx.clearRect(0,0,w,h);ctx.strokeStyle='#dfe6ff';ctx.globalAlpha=.35;ctx.lineWidth=1;const step=48;for(let x=0;x<w;x+=step){ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,h);ctx.stroke()}for(let y=0;y<h;y+=step){ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(w,y);ctx.stroke()}}
  addEventListener('resize',draw); draw();
})();

// dropdown
const dd=document.getElementById('dd');
dd.querySelector('button').addEventListener('click',()=>{dd.classList.toggle('open');dd.querySelector('button').setAttribute('aria-expanded',dd.classList.contains('open'))});
addEventListener('click',e=>{if(!dd.contains(e.target)) dd.classList.remove('open')});

// active nav + progress
const sections=[...document.querySelectorAll('main > section')];
const links=[...document.querySelectorAll('.menu a[href^="#"]')];
const io=new IntersectionObserver(es=>{es.forEach(e=>{if(e.isIntersecting){const id='#'+e.target.id;links.forEach(a=>a.classList.toggle('active',a.getAttribute('href')===id));}})},{threshold:.6});
sections.forEach(s=>io.observe(s));
const progress=document.getElementById('progress');
addEventListener('scroll',()=>{const m=document.documentElement.scrollHeight-innerHeight;progress.style.transform=`scaleX(${Math.max(0,Math.min(1,scrollY/m))})`},{passive:true});

// snap assist (нет «полуэкранов»)
let t=null;
function snap(){const vh=innerHeight;let best=null,dist=1e9;for(const s of sections){const d=Math.abs(s.getBoundingClientRect().top);if(d<dist){dist=d;best=s}} if(best&&dist>vh*.08) best.scrollIntoView({behavior:'smooth',block:'start'})}
addEventListener('scroll',()=>{clearTimeout(t);t=setTimeout(snap,120)},{passive:true});

// arrow
const hint=document.getElementById('hint'); let idx=0;
const io2=new IntersectionObserver(es=>{es.forEach(e=>{if(e.isIntersecting){idx=sections.indexOf(e.target);hint.style.display=(idx===sections.length-1)?'none':'flex'}})},{threshold:.7});
sections.forEach(s=>io2.observe(s));
hint.querySelector('button').addEventListener('click',()=>{sections[Math.min(sections.length-1,idx+1)]?.scrollIntoView({behavior:'smooth'})});

// year
document.getElementById('year').textContent=new Date().getFullYear();

// requisites modal
const modalReq=document.getElementById('modalReq');
document.getElementById('btnReq')?.addEventListener('click',()=>{modalReq.hidden=false});
document.getElementById('btnReqClose')?.addEventListener('click',()=>{modalReq.hidden=true});
modalReq.addEventListener('click',e=>{if(e.target===modalReq) modalReq.hidden=true});
addEventListener('keydown',e=>{if(e.key==='Escape') modalReq.hidden=true});

// brief submit
const form=document.getElementById('briefForm'); const msg=document.getElementById('formMsg');
form?.addEventListener('submit',async e=>{e.preventDefault(); const data=Object.fromEntries(new FormData(form).entries()); msg.textContent='Отправка…'; await new Promise(r=>setTimeout(r,800)); console.log('BRIEF',data); msg.textContent='Готово. Мы свяжемся в рабочее время.'; form.reset();});

// charts
const a=document.getElementById('a'), b=document.getElementById('b'), c=document.getElementById('c'), poly=document.getElementById('poly');
function drawLine(){const vals=[+a.value,(a.value*0.6+b.value*0.4),+b.value,(b.value*0.6+c.value*0.4),+c.value,+c.value+10].slice(0,6); const pts=vals.map((v,i)=>`${40+i*104},${200-(v/100)*140}`).join(' '); poly.setAttribute('points',pts)}
[a,b,c].forEach(el=>el?.addEventListener('input',drawLine)); drawLine();

const donut={total:2*Math.PI*80, els:[document.getElementById('d1'),document.getElementById('d2'),document.getElementById('d3')]};
const dn1=document.getElementById('dn1'), dn2=document.getElementById('dn2'), dn3=document.getElementById('dn3'), dLabel=document.getElementById('donutLabel');
function drawDonut(){const v1=+dn1.value,v2=+dn2.value,v3=+dn3.value,sum=Math.max(1,v1+v2+v3); const a1=donut.total*(v1/sum),a2=donut.total*(v2/sum),a3=donut.total*(v3/sum);
donut.els[0].setAttribute('stroke-dasharray',`${a1} ${donut.total-a1}`);
donut.els[1].setAttribute('stroke-dasharray',`${a2} ${donut.total-a2}`); donut.els[1].setAttribute('stroke-dashoffset',-a1);
donut.els[2].setAttribute('stroke-dasharray',`${a3} ${donut.total-a3}`); donut.els[2].setAttribute('stroke-dashoffset',-(a1+a2));
dLabel.textContent=`O:${v1}% P:${v2}% R:${v3}%`; }
[dn1,dn2,dn3].forEach(el=>el?.addEventListener('input',drawDonut)); drawDonut();
document.getElementById('btnResetCharts')?.addEventListener('click',()=>{a.value=30;b.value=60;c.value=80;dn1.value=40;dn2.value=35;dn3.value=25;drawLine();drawDonut();});
</script>
</body>
</html>
